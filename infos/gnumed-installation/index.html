<!DOCTYPE html>
<html lang="de" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>simpelmed - </title>

  <meta name="description" content="GNUmed Datenbank Installation Fahrplan In mehreren Schritten wird nun eine »leere« GNUmed-Datenbank installiert und eingerichtet, auf der die darauf folgenden Entwicklungsschritte stattfinden werden. Etwas vereinfacht sieht dies wie folgt aus: 1) Server-Pakete aus den Debian-Repos installieren, 2) Anpassung an deutsche Sprachversion vornehmen, 3) → Bugfix durchführen ← (je nach verwendeter Version der Daten lässt sich GNUmed sonst nicht installieren! siehe unten), 4) Bootstrap der GNUmed-Datenbank und schließlich 5) weitere Anpassungen vornehmen.">
  <meta name="author" content="Berthold Gehrke"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "simpelmed",
    
    "url": "https:\/\/simpelmed.de"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/simpelmed.de"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/simpelmed.de",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/simpelmed.de\/infos\/gnumed-installation\/",
          "name": ""
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Berthold Gehrke"
  },
  "headline": "",
  "description" : "GNUmed Datenbank Installation Fahrplan In mehreren Schritten wird nun eine »leere« GNUmed-Datenbank installiert und eingerichtet, auf der die darauf folgenden Entwicklungsschritte stattfinden werden. Etwas vereinfacht sieht dies wie folgt aus: 1) Server-Pakete aus den Debian-Repos installieren, 2) Anpassung an deutsche Sprachversion vornehmen, 3) → Bugfix durchführen ← (je nach verwendeter Version der Daten lässt sich GNUmed sonst nicht installieren! siehe unten), 4) Bootstrap der GNUmed-Datenbank und schließlich 5) weitere Anpassungen vornehmen.",
  "inLanguage" : "de",
  "wordCount":  1614 ,
  "datePublished" : "0001-01-01T00:00:00",
  "dateModified" : "0001-01-01T00:00:00",
  "image" : "https:\/\/simpelmed.de\/img\/simpelmed.jpg",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "https:\/\/simpelmed.de\/infos\/gnumed-installation\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/simpelmed.de",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/simpelmed.de\/img\/simpelmed.jpg",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="simpelmed" />
<meta property="og:description" content="GNUmed Datenbank Installation Fahrplan In mehreren Schritten wird nun eine »leere« GNUmed-Datenbank installiert und eingerichtet, auf der die darauf folgenden Entwicklungsschritte stattfinden werden. Etwas vereinfacht sieht dies wie folgt aus: 1) Server-Pakete aus den Debian-Repos installieren, 2) Anpassung an deutsche Sprachversion vornehmen, 3) → Bugfix durchführen ← (je nach verwendeter Version der Daten lässt sich GNUmed sonst nicht installieren! siehe unten), 4) Bootstrap der GNUmed-Datenbank und schließlich 5) weitere Anpassungen vornehmen.">
<meta property="og:image" content="https://simpelmed.de/img/simpelmed.jpg" />
<meta property="og:url" content="https://simpelmed.de/infos/gnumed-installation/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="simpelmed" />

  <meta name="twitter:title" content="simpelmed" />
  <meta name="twitter:description" content="GNUmed Datenbank Installation Fahrplan In mehreren Schritten wird nun eine »leere« GNUmed-Datenbank installiert und eingerichtet, auf der die darauf folgenden Entwicklungsschritte stattfinden werden. …">
  <meta name="twitter:image" content="https://simpelmed.de/img/simpelmed.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='https://simpelmed.de/img/simpelmed.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.115.4">
  <link rel="alternate" href="https://simpelmed.de/index.xml" type="application/rss+xml" title="simpelmed"><link rel="stylesheet" href="https://simpelmed.de/css/katex.min.css" />
  <link rel="stylesheet" href="https://simpelmed.de/fontawesome/css/all.css" />
  <link rel="stylesheet" href="https://simpelmed.de/css/bootstrap.min.css" /><link rel="stylesheet" href="https://simpelmed.de/css/main.css" /><link rel="stylesheet" href="https://simpelmed.de/css/fonts.css" /><link rel="stylesheet" href="https://simpelmed.de/css/syntax.css" /><link rel="stylesheet" href="https://simpelmed.de/css/codeblock.css" /><link rel="stylesheet" href="https://simpelmed.de/css/photoswipe.min.css" />
  <link rel="stylesheet" href="https://simpelmed.de/css/photoswipe.default-skin.min.css" />


<style>

 

div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}


div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}
</style>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://simpelmed.de">simpelmed</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Home" href="/">Home</a>
            </li>
          
        
          
            <li>
              <a title="Schnellstart" href="/schnellstart">Schnellstart</a>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent">Infos</a>
              <div class="navlinks-children">
                
                  <a href="/infos/arbeitsumgebung">Arbeitsumgebung</a>
                
                  <a href="/infos/postgresql-pgadmin">PostgreSQL-pgAdmin</a>
                
                  <a href="/infos/gnumed-installation">GNUmed-Installation</a>
                
                  <a href="/infos/gnumed-einrichtung">GNUmed-Einrichtung</a>
                
                  <a href="/infos/repo">Repo</a>
                
                  <a href="/infos/team">Team</a>
                
                  <a href="/infos/foerderung">Förderung</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent">Projekt</a>
              <div class="navlinks-children">
                
                  <a href="/projekt/simpelmed-start">SimpelMed-Start</a>
                
                  <a href="/projekt/downloads">Downloads</a>
                
                  <a href="/projekt/installscript">Installscript</a>
                
                  <a href="/projekt/remote-zugriff">Remote-Zugriff</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="FAQ / Häufige Fragen" href="/faq">FAQ / Häufige Fragen</a>
            </li>
          
        
          
            <li>
              <a title="datenschutz" href="/datenschutz">datenschutz</a>
            </li>
          
        
          
            <li>
              <a title="impressum" href="/impressum">impressum</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="simpelmed" href="https://simpelmed.de">
            <img class="avatar-img" src="https://simpelmed.de/img/simpelmed.jpg" alt="simpelmed" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  <div class="intro-header"></div>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <div class="sect1">
<h2 id="_gnumed_datenbank_installation">GNUmed Datenbank Installation</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1">
<h2 id="_fahrplan">Fahrplan</h2>
<div class="sectionbody">
<div class="paragraph"><p>In mehreren Schritten wird nun eine »leere« GNUmed-Datenbank installiert und eingerichtet, auf der die darauf folgenden Entwicklungsschritte stattfinden werden.<br/>
Etwas vereinfacht sieht dies wie folgt aus:<br/>
1) Server-Pakete aus den Debian-Repos installieren,<br/>
2) Anpassung an deutsche Sprachversion vornehmen,<br/>
3) → Bugfix durchführen ← (je nach verwendeter Version der Daten lässt sich GNUmed sonst nicht installieren! siehe unten),<br/>
4) <em>Bootstrap</em> der GNUmed-Datenbank und schließlich<br/>
5) weitere Anpassungen vornehmen.</p></div>
<div class="sect2">
<h3 id="_pakete_aus_dem_repo">Pakete aus dem Repo</h3>
<div class="paragraph"><p>Der erste Schritt ist schnell durchgeführt. Die GNUmed-Server-Pakete werden installiert.</p></div>
<div class="listingblock">
<div class="title">Installation der Debian-Pakete</div>
<div class="content">
<pre><code>apt install --no-install-recommends --no-install-suggests postgresql-client
apt install --no-install-recommends --no-install-suggests gnumed-server</code></pre>
</div></div>
<div class="paragraph"><p>Erläuterung: Die empfohlenen und/oder vorgeschlagenen Paktete braucht es vorerst nicht. Falls noch kein PostgreSQL installiert ist, geschieht dies spätestens jetzt zusammen mit <em>gnumed-server</em>. Es ist allerdings sicherer, PostgreSQL vorab wie in unserem Vorgehen zu installieren, damit sichergestellt ist, dass nicht z.B. Version 16 (die ist noch zu »frisch«) und die <em>US-Tastatur</em> gewählt wird.</p></div>
<div class="paragraph"><p>Versucht der geneigte Anwender, nun gleich <em>gm-bootstrap_server</em> auszuführen, wird dies (Stand Okt. &#39;23) leider nicht immer fuktionieren. Das Programm bricht ab mit folgender Meldung.</p></div>
<div class="listingblock">
<div class="title">Abbruch der GNUmed-Server-Installation</div>
<div class="content">
<pre><code>...
==&gt; transferring users ...
    ... skipped (unconfigured)
==&gt; bootstrapping &#34;v2-v3-dynamic&#34; ...
Cannot bootstrap bundles.

Please check the log file for details:

  /var/log/gnumed/server/bootstrap-latest.log

Bootstrapping &#34;gnumed_v22&#34; did not finish successfully (1). Aborting.
...</code></pre>
</div></div>
<div class="paragraph"><p>Im erwähnten Log-File (gekürzt …) könnte Folgendes zu lesen sein:</p></div>
<div class="listingblock">
<div class="title">Log-Meldungen zum Abbruch (Ausschnnitt)</div>
<div class="content">
<pre><code>...
2023-09-22 14:37:42  DEBUG     gm.db_pool    [140273691701248 MainThread]  ..
2023-09-22 14:37:42  DEBUG     gm.db_pool    [140273691701248 MainThread]  ..
2023-09-22 14:37:42  INFO      gm.bootstrapper  [140273691701248 MainThread] .
2023-09-22 14:37:42  ERROR     gm.bootstrapper  [140273691701248 MainThread] .
Traceback (most recent call last):
  File &#34;/var/lib/gnumed/server/bootstrap/./bootstrap_gm_db_system.py&#34;, line 641, in __bootstrap
    text = gmPG2.get_db_fingerprint(conn = self.conn, eol = &#39;\n&#39;)
  File &#34;/var/lib/gnumed/Gnumed/pycommon/gmPG2.py&#34;, line 483, in get_db_fingerprint
    curs.execute(cmd)
  File &#34;/usr/lib/python3/dist-packages/psycopg2/extras.py&#34;, line 146, in execute
    return super().execute(query, vars)
psycopg2.errors.InvalidSchemaName: schema &#34;gm&#34; does not exist
LINE 1: SELECT md5(gm.concat_table_structure())
                   ^
2023-09-22 14:37:42  DEBUG     gm.cfg        [140273691701248 MainThread]  ..
2023-09-22 14:37:42  WARNING   gm.bootstrapper  [140273691701248 MainThread] ..
2023-09-22 14:37:42  INFO      gm.bootstrapper  [140273691701248 MainThread] ..
...</code></pre>
</div></div>
<div class="paragraph"><p>Leider läuft der fehlschlagende Installationsversuch noch einige Meldungen weiter, gezeigt im obigen Ausschnitt ist nur die erste Fehlermeldung.<br/>
Es kann aber auch auf andere Weise »schief gehen«. Dringend zu empfehlen oder sogar unumgänglich sind deshalb folgenden Maßnahmen.</p></div>
</div>
<div class="sect2">
<h3 id="_anpassung_an_die_sprache_deutsch">Anpassung an die Sprache Deutsch</h3>
<div class="paragraph"><p>Die Standard-Sprache des Gnumed-Server-Pakets ist englisch. Das ist auch nicht weiter tragisch, wenn der Nutzer hierzulande einige Hinweise beachtet. Wurde der PostgreSQL-Server wie dargestellt schon vor den GNUmed-Paketen installiert, ist in der Regel für alle Datenbanken der Zeichensatz de_DE.utf8 voreingestellt. Dies sollte nicht geändert werden, um die Umlaute korrekt darzustellen. Damit ist dieser Punkt bereits durch eine Standard-Installation der PostgreSQL-Pakete erledigt.</p></div>
</div>
<div class="sect2">
<h3 id="_bugfix_für_bestimmte_distributionen">Bugfix für bestimmte Distributionen</h3>
<div class="paragraph"><p>Sobald das Kommando <em>gm-bootstrap_server</em> (zwingend als root/mittels sudo) aufgerufen wird, führt das Programm im Folgenden auch das Skript <em>bootstrap-latest.sh</em> aus. Diese Datei befindet sich im Ordner <em>/var/lib/gnumed/server/bootstrap</em>. Einige Betriebssystem-Plattformen kommen mit folgender Zeile nicht zurecht, die deshalb angepasst werden sollte.</p></div>
<div class="paragraph"><p>Eine Zeile der Datei muss geändert werden:</p></div>
<div class="listingblock">
<div class="title">Bugfix GNUmed Installation, Datei <em>/var/lib/gnumed/server/bootstrap</em></div>
<div class="content">
<pre><code># vorher
CONF=&#34;bootstrap-latest.conf&#34;

# nachher
CONF=&#34;./bootstrap-latest.conf&#34;</code></pre>
</div></div>
<div class="paragraph"><p>Noch einmal zur Wiederholung: Dieser Schritt ist keineswegs zwingend, sondern nur für einige Betriebssysteme überhaupt notwendig.</p></div>
</div>
<div class="sect2">
<h3 id="_falsche_datei_version">Falsche Datei-Version</h3>
<div class="paragraph"><p>Weitaus häufiger tritt folgender Fehler auf. In manchen älteren Repos und Download-Dateien findet sich noch eine veraltete Version der Datei <em>../server/sql/v2-v3/dynamic/cfg-set_option.sql</em>. Zu erkennen ist die veraltete Version z.B. auf diese Weise:</p></div>
<div class="listingblock">
<div class="title">Veraltete Version <em>cfg-set_option.sql</em></div>
<div class="content">
<pre><code>b@bpc~$ sed -n 95,100p /var/lib/gnumed/server/sql/v2-v3/dynamic/cfg-set_option.sql

(gekürzt)
begin
        -- determine data type
        if _value is of (text, char, varchar, name) then
                val_type := &#39;&#39;string&#39;&#39;;
        elsif _value is of (smallint, integer, bigint, numeric, boolean) then
                val_type := &#39;&#39;numeric&#39;&#39;;
b@bpc:~$</code></pre>
</div></div>
<div class="paragraph"><p>Die gewünschte neuere Version lieferte hier:</p></div>
<div class="listingblock">
<div class="title">Korrekte Version <em>cfg-set_option.sql</em></div>
<div class="content">
<pre><code>b@bpc~$ sed -n 85,100p /var/lib/gnumed/server/sql/v2-v3/dynamic/cfg-set_option.sql

(gekürzt)
begin
-- determine data type
        if pg_typeof(_value) in (&#39;&#39;text&#39;&#39;::regtype, &#39;&#39;char&#39;&#39;: &lt;gekürzt&gt; ...::regtype) then
                val_type := &#39;&#39;string&#39;&#39;;
        elsif pg_typeof(_value) in (&#39;&#39;smallint&#39;&#39;::regtype, &lt;gekürzt&gt; ... ::regtype) then
                val_type := &#39;&#39;numeric&#39;&#39;;
b@bpc:~$</code></pre>
</div></div>
<div class="paragraph"><p>Der Unterschied ist klar: in der neuen Version wird die eingebaute Funktion pg_typeof() verwendet.<br/></p></div>
</div>
<div class="sect2">
<h3 id="_repo_simpelmed">Repo SimpelMed</h3>
<div class="paragraph"><p>Bei Bedarf findet sich die korrekte Version - wie alle erwähnten Dateien - im</p></div>
<a href="https://gitlab.com/bgehrke/simpelmed">Simpelmed-Repo</a>.
<br/>
<img align="left" width="30" height="30" src="/leeres_png.png"/>
<br/>
</div>
<div class="sect2">
<h3 id="_bootstrap_der_gnumed_datenbank">Bootstrap der GNUmed-Datenbank</h3>
<div class="paragraph"><p>Nun ist es an der Zeit, endlich die eigene GNUmed-Datenbank zu erzeugen:</p></div>
<div class="listingblock">
<div class="title">Bootstrap (erfolgreich - Ausgabe gekürzt!)</div>
<div class="content">
<pre><code> h@hpc:~$ sudo gm-bootstrap_server
 ===========================================================
 Bootstrapping latest GNUmed database.

 This will set up a GNUmed database of version v22
 with the name &#34;gnumed_v22&#34;.
 Creating module import symlink ...
  real dir: /var/lib/gnumed/server
      link: /var/lib/gnumed/Gnumed
 Adjusting PYTHONPATH ...
 =======================================
 Bootstrapping GNUmed database system...
 =======================================
 You are about to install the following parts of GNUmed:
 -------------------------------------------------------
 bundle &#34;config&#34; in &lt;gnumed_v2&gt; (or overridden) on &lt;&gt;
 bundle &#34;reference&#34; in &lt;gnumed_v2&gt; (or overridden) on &lt;&gt;
 bundle &#34;demographics&#34; in &lt;gnumed_v2&gt; (or overridden) on &lt;&gt;
 bundle &#34;clinical&#34; in &lt;gnumed_v2&gt; (or overridden) on &lt;&gt;
 bundle &#34;documents&#34; in &lt;gnumed_v2&gt; (or overridden) on &lt;&gt;
 bundle &#34;office&#34; in &lt;gnumed_v2&gt; (or overridden) on &lt;&gt;
 -------------------------------------------------------
 This will set up a monolithic GNUmed backend with all bundles
 ...
 ...
 ==&gt; bootstrapping &#34;v9-v10-static&#34; ...
 ==&gt; cloning [gnumed_v9] (23 MB) as target database [gnumed_v10] ...
 ==&gt; reindexing target database (can take a while) ...
 ==&gt; revalidating constraints in target database (can take a while) ...
 ==&gt; transferring users ...
 ==&gt; bootstrapping &#34;v9-v10-dynamic&#34; ...
 ==&gt; bootstrapping &#34;v10-fixups&#34; ...
 ==&gt; setting up auditing ...
     ... skipped (disabled)
 ==&gt; setting up encounter/episode FKs and IDXs ...
 ==&gt; upgrading reference data sets ...
     ... skipped (no scripts to run)
 You are about to install the following parts of GNUmed:
 -------------------------------------------------------
 bundle &#34;v10_fixups-pre_v11&#34; in &lt;gnumed_v11&gt; (or overridden) on &lt;&gt;
 bundle &#34;v10-v11-static&#34; in &lt;gnumed_v11&gt; (or overridden) on &lt;&gt;
 bundle &#34;v10-v11-dynamic&#34; in &lt;gnumed_v11&gt; (or overridden) on &lt;&gt;
 bundle &#34;v11-fixups&#34; in &lt;gnumed_v11&gt; (or overridden) on &lt;&gt;
 bundle &#34;v11-test_data&#34; in &lt;gnumed_v11&gt; (or overridden) on &lt;&gt;
 -------------------------------------------------------
 This will update an existing GNUmed version 10
 database to the version 11 schema. It does not do
 any harm to the data contained within.
 ...
 ...
 This will update an existing GNUmed version 21
 database to the version 22 schema. It does not do
 any harm to the data contained within.
 ...
 ...
 ==&gt; checking migrated data for plausibility ...
 ==&gt; sanity checking PostgreSQL authentication settings ...

 Note that even after successfully bootstrapping the GNUmed
 database PostgreSQL may still need to be configured to
 allow GNUmed clients to connect to it.

 In many standard PostgreSQL installations this amounts to
 adding (or uncommenting) the authentication directive:

   &#34;local   samerole    +gm-logins   md5&#34;

 in the proper place of the file:

   /etc/postgresql/15/main/pg_hba.conf

 For details refer to the GNUmed documentation at:

   http://wiki.gnumed.de/bin/view/Gnumed/ConfigurePostgreSQL

 Done bootstrapping GNUmed database: We very likely succeeded.
 log: /var/log/gnumed/server/bootstrap-latest.log
 Dropping obsoleted staging database gnumed_v2 ...
 ...
 ...
 Dropping obsoleted staging database gnumed_v20 ...
 (you may need to provide the password for root)
 h@hpc:~$</code></pre>
</div></div>
<div class="paragraph"><p>Dieser Vorgang benötigt auch auf einem modernen, schnellen PC ca. vier Minuten …</p></div>
<br/>
<img align="left" width="30" height="30" src="/leeres_png.png"/>
<br/>
</div>
<div class="sect2">
<h3 id="_download_vorkonfigurierter_gnumed_datenbanken">Download vorkonfigurierter GNUmed-Datenbanken</h3>
<div class="paragraph"><p>Falls die Erstellung der eigenen Datenbank - aus welchen Gründen auch immer - nicht vollständig durchläuft oder das Bootstrapping umgangen werden soll, stehen »fertige« Pakete zum Download bereit. Das Download-Verzeichnis wird bereitgestellt unter <a href="https://datenbahn.de/simpelmed">https://datenbahn.de/simpelmed</a><br/>
Im Einzelnen sind das folgende Varianten.</p></div>
<div class="paragraph"><p><strong>pg15gnumed.tar</strong><br/>
Dies ist das Archiv einer frischen, vollständig installierten, sonst »leeren«, GNUmed-PostgreSQL Datenbank. Nur verwendbar mit Version 15 und nur auf einer Debian oder Ubuntu Plattform eines GNU/Linux-Systems. Darüber hinuas müssen natürlich noch die entsprechenden Berechtigungen in den PostgreSQL-Konfigurationsdateien eingerichtet werden.</p></div>
<br/>
<img align="left" width="55" height="55" src="/warning.png"/><br/>   Alle Dateien des Postgres-Clusters werden durch diesen Vorgang unwiederbringlich gelöscht! Alle Tabellen, Schemata, Nutzer etc. des bisherigen PostgreSQL-Servers werden ohne Warnung und ohne Backup überschrieben und sind -&gt;* weg *&lt;- !
<br/>
<div class="paragraph"><p>Vorgehen:<br/>
1) Download des Archivs</p></div>
wget https://datenbahn.de/simpelmed/pg15gnumed.tar
<div class="paragraph"><p>2) Stoppen des PostgreSQL-15 Servers</p></div>
sudo systemctl stop postgresql
<div class="paragraph"><p>3) Überprüfung des Inhaltes der tar-Datei</p></div>
tar -tvf ./pg15gnumed.tar
<div class="paragraph"><p>Wird das Archiv tatsächlich an den korrekten Ort installiert, z.B.<br/>
/var/lib/postgresql/15/main?</p></div>
<div class="paragraph"><p>4) Installation/Entpacken</p></div>
sudo tar -xzf ./pg15gnumed.tar -C /
<div class="paragraph"><p>Die Option <em>-C</em> und das schließende <em>/</em> sind notwendig!</p></div>
<div class="paragraph"><p>5) Starten des PostgreSQL-15 Servers</p></div>
sudo systemctl start postgresql
<br/>
<img align="left" width="30" height="30" src="/leeres_png.png"/>
<br/>
<div class="paragraph"><p><strong>dumpall_gnumed_simpelmed_start.sql</strong><br/>
Dies ist ein vollständiger Dump der Datenbank nach Installation des GNUmed-Servers aus den Repos. Der Vorteil dieses Vorgehens besteht darin, daß auch andere Versionen als 15 Zielserver sein können; auch ein Plattformwechsel zu Nicht-Debian oder hin zu Windows ist möglich. Hier werden darüber hinaus keine Dateien überschrieben oder gehen verloren, es dürfen allerdings keine GNUmed-Datei oder gleichnamige Nutzer vorhanden sein.</p></div>
<div class="paragraph"><p>Vorgehen:<br/>
1) Download des Dumps</p></div>
wget https://datenbahn.de/simpelmed/dumpall_gnumed_simpelmed_start.sql
<div class="paragraph"><p>2) Der PostgreSQL-Servers muss laufen - überprüfen mit</p></div>
sudo systemctl status postgresql
<div class="paragraph"><p>3) Einspielen der Dump-Datei</p></div>
sudo -u postgres psql &lt; dumpall_gnumed_simpelmed_start.sql
<br/>
<img align="left" width="30" height="30" src="/leeres_png.png"/>
<br/>
<br/>
<img align="left" width="55" height="55" src="/tip.png"/><br/>   Zur Vermeidung der Fehlermeldung &#39;cannot execute CREATE TABLE in a read-only transaction&#39; und ähnlichem wurde die Dump-Datei an zwei Stellen modifiziert.
<div class="paragraph"><p>Vorher:<br/>
ALTER DATABASE gnumed_v21 SET default_transaction_read_only TO <em>on</em>;<br/>
nachher:<br/>
ALTER DATABASE gnumed_v21 SET default_transaction_read_only TO <em>off</em>;<br/>
Analog in der Zeile <em>ALTER DATABASE gnumed_v22 SET default_ …</em><br/>
Einmal also für gnumed_v21, einmal für gnumed_v22.</p></div>
<div class="paragraph"><p>Dies ist auch mit folgendem kurzen Python-Programm möglich, bitte setzen Sie die eigenen Parameter ein:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>#!/usr/bin/env python3
&#34;&#34;&#34; Setze alle &#39;default_transaction_read_only&#39; auf &#39;off&#39;

    Autor: Berthold Gehrke &lt;kontakt@simpelmed.de&gt;
    (c) 2023, GPLv3
    &#34;&#34;&#34;

#import re   # für diese einfache Aufgbae nicht notwendig, auskommentieren bei Bedarf

# Eingabe-Datei
eingabe = &#39;/home/&lt;user&gt;/original.sql&#39;
ausgabe = &#39;/home/&lt;user&gt;/bearbeitet.sql&#39;

# Die Original-Datei wird gelesen - diese wird nicht verändert.
with open(eingabe, &#34;r&#34;) as die_eingabe:
    a = die_eingabe.read()

print(&#34;Eingabe:&#34;, eingabe)
print(&#34;Ausgabe:&#34;, ausgabe)

a, zaehler = re.subn(r&#34;SET default_transaction_read_only TO &#39;on&#39;;&#34;, r&#34;SET default_transaction_read_only TO &#39;off&#39;;&#34;, a)
print(&#34;&#34;)
print(&#34;Bearbeite die Ersetzung vorher - SET default_transaction_read_only TO &#39;on&#39; - jetzt - SET default_transaction_read_only TO &#39;off&#39;;&#34;)
print(&#34;&#34;)
print(&#34;Die Ersetzung wurde wie oft durchgeführt?&#34;, zaehler, &#34;Mal.&#34;)

a, zaehler = re.subn(r&#34;SET default_transaction_read_only = on;&#34;, r&#34;SET default_transaction_read_only = off;&#34;, a)
print(&#34;&#34;)
print(&#34;Bearbeite die Ersetzung vorher - SET default_transaction_read_only = on; - jetzt - SET default_transaction_read_only = off;&#34;)
print(&#34;&#34;)
print(&#34;Die Ersetzung wurde wie oft durchgeführt?&#34;, zaehler, &#34;Mal.&#34;)

with open(ausgabe, &#34;w&#34;) as die_ausgabe:
    die_ausgabe.write(a)</code></pre>
</div></div>
<br/>
<img align="left" width="55" height="55" src="/note.png"/> Fazit bis hier:
Die Installation der GNUmed-Pakete aus den Repos sollte nun abgeschlossen sein. Der nächste Schritt besteht darin, die internationale Standard Erstinstallation für die weiteren Zwecke einzurichten.
<div class="paragraph"><p>Diese oben unter »Punkt 5) weitere Anpassungen vornehmen« Schritte werden im nächsten Abschnitt »gnumed-einrichtung« beschrieben.</p></div>
<div class="paragraph"><p><br/></p></div>
<div class="paragraph"><p></p><hr/><p></p></div>
<div class="paragraph"><p>-&gt; Zurück zu <a href="../arbeitsumgebung">arbeitsumgebung</a>.</p></div>
<div class="paragraph"><p>-&gt; Zurück zu <a href="../postgresql-pgadmin">postgresql-pgadmin</a>.</p></div>
<div class="paragraph"><p>-&gt; Weiter zu <a href="../gnumed-einrichtung">gnumed-einrichtung</a>.</p></div>
</div>
</div>
</div>


        

        

        
      </article>



      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
		
		  <a href="mailto:kontakt@simpelmed.de" title="Email me">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://gitlab.com/bgehrke/simpelmed/" title="GitLab">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-gitlab fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&copy;&nbsp;2023, 2024
          
          by Berthold Gehrke & Alexandra Rupp GbR &nbsp;&bull;&nbsp;letzte Änderung am 13. Februar 2024
          
          

        </p>
        
        <p class="credits theme-by text-muted">
          Seiten erstellt mit: <a href="https://gohugo.io">Hugo v0.115.4</a> &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> angepasst von <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> und <a href="https://datenbahn.de/">datenbahn</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://simpelmed.de/js/katex.min.js"></script>
<script defer src="https://simpelmed.de/js/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
<script src="https://simpelmed.de/js/jquery-3.7.0.slim.min.js"></script>
<script src="https://simpelmed.de/js/bootstrap.min.js"></script>

<script src="https://simpelmed.de/js/main.js"></script><script src="https://simpelmed.de/js/photoswipe.min.js"></script>
<script src="https://simpelmed.de/js/photoswipe-ui-default.min.js"></script><script src="https://simpelmed.de/js/load-photoswipe.js"></script>









    
  </body>
</html>

